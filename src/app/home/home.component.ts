import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';

interface ShogiPiece {
    type: string;
    color: 'white' | 'black';
    position: { row: number; col: number };
    kanji: string;
    canMove: boolean;
}

@Component({
    selector: 'app-home',
    standalone: true,
    imports: [CommonModule],
    template: `
    <div class="manga-page-container">
      <!-- En-tÃªte manga avec titre stylisÃ© -->
      <header class="manga-header">
        <div class="title-container">
          <h1 class="manga-title">L'Ã‰VEIL DES OMBRES</h1>
          <div class="title-decoration">
            <span class="decoration-line"></span>
            <span class="decoration-symbol">ðŸŒ‘</span>
            <span class="decoration-line"></span>
          </div>
          <h2 class="manga-subtitle">CLAN NARA - LA SAGESSE DANS LES TÃ‰NÃˆBRES</h2>
        </div>
      </header>

      <!-- Section principale avec layout manga -->
      <main class="manga-content">
        <!-- Panneau gauche - Logo et prÃ©sentation -->
        <div class="manga-panel left-panel">
          <div class="clan-logo-section">
            <div class="logo-container">
              <img src="assets/Nara_Symbol.png" alt="Symbole du Clan Nara" class="nara-symbol-manga">
              <div class="logo-aura"></div>
            </div>
            <div class="clan-intro">
              <h3 class="panel-title">Le Clan Nara</h3>
              <p class="manga-text">Gardiens des ombres ancestrales, maÃ®tres de la stratÃ©gie et de la sagesse. Leur pouvoir rÃ©side dans la manipulation des tÃ©nÃ¨bres pour protÃ©ger la lumiÃ¨re.</p>
            </div>
          </div>
        </div>

        <!-- Panneau central - Ã‰chiquier Shogi -->
        <div class="manga-panel center-panel">
          <div class="shogi-section">
            <h3 class="panel-title">StratÃ©gie du Clan</h3>
            <div class="shogi-board-container">
              <div class="shogi-board">
                <div class="board-grid">
                  <div class="board-row" *ngFor="let row of boardRows; let rowIndex = index">
                    <div class="board-cell" 
                         *ngFor="let col of boardCols; let colIndex = index"
                         [class.highlighted]="isHighlighted(rowIndex, colIndex)"
                         [class.valid-move]="isValidMove(rowIndex, colIndex)"
                         [class.drag-over]="isDragOver(rowIndex, colIndex)"
                         (click)="onCellClick(rowIndex, colIndex)"
                         (dragover)="onDragOver($event, rowIndex, colIndex)"
                         (dragleave)="onDragLeave($event)"
                         (drop)="onDrop($event, rowIndex, colIndex)">
                      
                      <!-- PiÃ¨ce de Shogi -->
                      <div class="shogi-piece" 
                           *ngIf="getPieceAt(rowIndex, colIndex)"
                           [class.selected]="isSelected(rowIndex, colIndex)"
                           [class.white-piece]="getPieceAt(rowIndex, colIndex)?.color === 'white'"
                           [class.black-piece]="getPieceAt(rowIndex, colIndex)?.color === 'black'"
                           [class.dragging]="isDragging(rowIndex, colIndex)"
                           [draggable]="getPieceAt(rowIndex, colIndex)?.color === 'white'"
                           (dragstart)="onDragStart($event, rowIndex, colIndex)"
                           (dragend)="onDragEnd($event)"
                           (click)="onPieceClick(rowIndex, colIndex, $event)">
                        <span class="piece-kanji">{{ getPieceAt(rowIndex, colIndex)?.kanji }}</span>
                      </div>
                      
                      <!-- Points de promotion -->
                      <div class="promotion-dot" 
                           *ngIf="isPromotionZone(rowIndex, colIndex)"></div>
                    </div>
                  </div>
                </div>
                
                <!-- LÃ©gende des piÃ¨ces -->
                <div class="piece-legend">
                  <h4>PiÃ¨ces du Clan</h4>
                  <div class="legend-items">
                    <div class="legend-item" *ngFor="let piece of pieceTypes">
                      <span class="legend-kanji">{{ piece.kanji }}</span>
                      <span class="legend-name">{{ piece.name }}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Instructions -->
              <div class="shogi-instructions">
                <p><strong>Instructions :</strong></p>
                <p>â€¢ Glissez-dÃ©posez une piÃ¨ce blanche pour la dÃ©placer</p>
                <p>â€¢ Ou cliquez sur une piÃ¨ce puis sur une case vide</p>
                <p>â€¢ Mouvement limitÃ© Ã  1 case maximum</p>
                <p>â€¢ Seules les piÃ¨ces blanches peuvent bouger</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Panneau droit - Photo et histoire -->
        <div class="manga-panel right-panel">
          <div class="photo-story-section">
            <!-- Cadre photo style manga -->
            <div class="manga-photo-frame">
              <div class="frame-border-manga">
                <div class="corner-decoration top-left"></div>
                <div class="corner-decoration top-right"></div>
                <div class="corner-decoration bottom-left"></div>
                <div class="corner-decoration bottom-right"></div>
              </div>
              <div class="photo-content">
                <div class="camera-icon">ðŸ“·</div>
                <p class="photo-text">Votre moment avec le clan</p>
                <small class="photo-hint">Cliquez pour immortaliser</small>
              </div>
            </div>
            
            <!-- Histoire du clan -->
            <div class="clan-story">
              <h4 class="story-title">La LÃ©gende</h4>
              <p class="story-text">Dans les temps anciens, au cÅ“ur de la forÃªt sacrÃ©e de Konoha, vivait un clan mystÃ©rieux dont la sagesse Ã©tait aussi profonde que les ombres qu'ils manipulaient...</p>
            </div>
          </div>
        </div>
      </main>

      <!-- Section basse avec caractÃ©ristiques -->
      <section class="manga-bottom-section">
        <div class="features-grid">
          <div class="feature-item" *ngFor="let feature of clanFeatures">
            <div class="feature-icon">{{ feature.icon }}</div>
            <h4 class="feature-title">{{ feature.title }}</h4>
            <p class="feature-desc">{{ feature.description }}</p>
          </div>
        </div>
      </section>

      <!-- Call to action style manga -->
      <footer class="manga-footer">
        <div class="cta-container">
          <h3 class="cta-title">PrÃªt Ã  rejoindre le clan ?</h3>
          <button class="manga-button" (click)="enterClan()">
            <span class="button-text">ENTRER DANS L'OMBRE</span>
            <div class="button-effect"></div>
          </button>
        </div>
      </footer>
    </div>
  `,
    styleUrls: ['./home.component.scss']
})
export class HomeComponent {
    // Configuration de l'Ã©chiquier Shogi
    boardRows = Array.from({ length: 9 }, (_, i) => i);
    boardCols = Array.from({ length: 9 }, (_, i) => i);

    selectedPiece: { row: number; col: number } | null = null;
    draggedPiece: { row: number; col: number } | null = null;
    dragOverCell: { row: number; col: number } | null = null;

    // Types de piÃ¨ces avec leurs kanji
    pieceTypes = [
        { kanji: 'çŽ‹', name: 'Roi' },
        { kanji: 'é‡‘', name: 'GÃ©nÃ©ral d\'Or' },
        { kanji: 'éŠ€', name: 'GÃ©nÃ©ral d\'Argent' },
        { kanji: 'æ¡‚', name: 'Cavalier' },
        { kanji: 'é¦™', name: 'Lance' },
        { kanji: 'é£›', name: 'Tour' },
        { kanji: 'è§’', name: 'Fou' },
        { kanji: 'æ­¥', name: 'Pion' }
    ];

    // PiÃ¨ces sur l'Ã©chiquier (position initiale comme sur votre image)
    shogiPieces: ShogiPiece[] = [
        // PiÃ¨ces blanches (en bas) - couleur claire
        { type: 'é¦™', color: 'white', position: { row: 8, col: 0 }, kanji: 'é¦™', canMove: true },
        { type: 'æ¡‚', color: 'white', position: { row: 8, col: 1 }, kanji: 'æ¡‚', canMove: true },
        { type: 'éŠ€', color: 'white', position: { row: 8, col: 2 }, kanji: 'éŠ€', canMove: true },
        { type: 'é‡‘', color: 'white', position: { row: 8, col: 3 }, kanji: 'é‡‘', canMove: true },
        { type: 'çŽ‹', color: 'white', position: { row: 8, col: 4 }, kanji: 'çŽ‹', canMove: true },
        { type: 'é‡‘', color: 'white', position: { row: 8, col: 5 }, kanji: 'é‡‘', canMove: true },
        { type: 'éŠ€', color: 'white', position: { row: 8, col: 6 }, kanji: 'éŠ€', canMove: true },
        { type: 'æ¡‚', color: 'white', position: { row: 8, col: 7 }, kanji: 'æ¡‚', canMove: true },
        { type: 'é¦™', color: 'white', position: { row: 8, col: 8 }, kanji: 'é¦™', canMove: true },
        { type: 'è§’', color: 'white', position: { row: 7, col: 1 }, kanji: 'è§’', canMove: true },
        { type: 'é£›', color: 'white', position: { row: 7, col: 7 }, kanji: 'é£›', canMove: true },
        { type: 'æ­¥', color: 'white', position: { row: 6, col: 0 }, kanji: 'æ­¥', canMove: true },
        { type: 'æ­¥', color: 'white', position: { row: 6, col: 1 }, kanji: 'æ­¥', canMove: true },
        { type: 'æ­¥', color: 'white', position: { row: 6, col: 2 }, kanji: 'æ­¥', canMove: true },
        { type: 'æ­¥', color: 'white', position: { row: 6, col: 3 }, kanji: 'æ­¥', canMove: true },
        { type: 'æ­¥', color: 'white', position: { row: 6, col: 4 }, kanji: 'æ­¥', canMove: true },
        { type: 'æ­¥', color: 'white', position: { row: 6, col: 5 }, kanji: 'æ­¥', canMove: true },
        { type: 'æ­¥', color: 'white', position: { row: 6, col: 6 }, kanji: 'æ­¥', canMove: true },
        { type: 'æ­¥', color: 'white', position: { row: 6, col: 7 }, kanji: 'æ­¥', canMove: true },
        { type: 'æ­¥', color: 'white', position: { row: 6, col: 8 }, kanji: 'æ­¥', canMove: true },

        // PiÃ¨ces noires (en haut) - couleur foncÃ©e
        { type: 'é¦™', color: 'black', position: { row: 0, col: 0 }, kanji: 'é¦™', canMove: false },
        { type: 'æ¡‚', color: 'black', position: { row: 0, col: 1 }, kanji: 'æ¡‚', canMove: false },
        { type: 'éŠ€', color: 'black', position: { row: 0, col: 2 }, kanji: 'éŠ€', canMove: false },
        { type: 'é‡‘', color: 'black', position: { row: 0, col: 3 }, kanji: 'é‡‘', canMove: false },
        { type: 'çŽ‹', color: 'black', position: { row: 0, col: 4 }, kanji: 'çŽ‹', canMove: false },
        { type: 'é‡‘', color: 'black', position: { row: 0, col: 5 }, kanji: 'é‡‘', canMove: false },
        { type: 'éŠ€', color: 'black', position: { row: 0, col: 6 }, kanji: 'éŠ€', canMove: false },
        { type: 'æ¡‚', color: 'black', position: { row: 0, col: 7 }, kanji: 'æ¡‚', canMove: false },
        { type: 'é¦™', color: 'black', position: { row: 0, col: 8 }, kanji: 'é¦™', canMove: false },
        { type: 'è§’', color: 'black', position: { row: 1, col: 7 }, kanji: 'è§’', canMove: false },
        { type: 'é£›', color: 'black', position: { row: 1, col: 1 }, kanji: 'é£›', canMove: false },
        { type: 'æ­¥', color: 'black', position: { row: 2, col: 0 }, kanji: 'æ­¥', canMove: false },
        { type: 'æ­¥', color: 'black', position: { row: 2, col: 1 }, kanji: 'æ­¥', canMove: false },
        { type: 'æ­¥', color: 'black', position: { row: 2, col: 2 }, kanji: 'æ­¥', canMove: false },
        { type: 'æ­¥', color: 'black', position: { row: 2, col: 3 }, kanji: 'æ­¥', canMove: false },
        { type: 'æ­¥', color: 'black', position: { row: 2, col: 4 }, kanji: 'æ­¥', canMove: false },
        { type: 'æ­¥', color: 'black', position: { row: 2, col: 5 }, kanji: 'æ­¥', canMove: false },
        { type: 'æ­¥', color: 'black', position: { row: 2, col: 6 }, kanji: 'æ­¥', canMove: false },
        { type: 'æ­¥', color: 'black', position: { row: 2, col: 7 }, kanji: 'æ­¥', canMove: false },
        { type: 'æ­¥', color: 'black', position: { row: 2, col: 8 }, kanji: 'æ­¥', canMove: false }
    ];

    clanFeatures = [
        {
            icon: 'ðŸ§ ',
            title: 'Intelligence Exceptionnelle',
            description: 'IQ de 200+, stratÃ©gies complexes et planification'
        },
        {
            icon: 'ðŸ¦Œ',
            title: 'Symbole du Cerf',
            description: 'ReprÃ©sente la sagesse et la grÃ¢ce du clan'
        },
        {
            icon: 'ðŸŒ¿',
            title: 'MÃ©decine Traditionnelle',
            description: 'Connaissance des herbes et remÃ¨des ancestraux'
        }
    ];

    // MÃ©thodes pour l'Ã©chiquier Shogi
    getPieceAt(row: number, col: number): ShogiPiece | undefined {
        return this.shogiPieces.find(piece =>
            piece.position.row === row && piece.position.col === col
        );
    }

    isSelected(row: number, col: number): boolean {
        return this.selectedPiece?.row === row && this.selectedPiece?.col === col;
    }

    isHighlighted(row: number, col: number): boolean {
        return this.selectedPiece?.row === row && this.selectedPiece?.col === col;
    }

    isDragging(row: number, col: number): boolean {
        return this.draggedPiece?.row === row && this.draggedPiece?.col === col;
    }

    isDragOver(row: number, col: number): boolean {
        return this.dragOverCell?.row === row && this.dragOverCell?.col === col;
    }

    isValidMove(row: number, col: number): boolean {
        if (!this.selectedPiece && !this.draggedPiece) return false;

        const sourcePos = this.selectedPiece || this.draggedPiece;
        if (!sourcePos) return false;

        const piece = this.getPieceAt(sourcePos.row, sourcePos.col);
        if (!piece || piece.color !== 'white') return false;

        // VÃ©rifier si la case de destination est vide
        if (this.getPieceAt(row, col)) return false;

        // VÃ©rifier si le mouvement est d'une seule case
        const rowDiff = Math.abs(row - sourcePos.row);
        const colDiff = Math.abs(col - sourcePos.col);

        // Mouvement d'une seule case (horizontale, verticale ou diagonale)
        return (rowDiff === 1 && colDiff === 0) ||
            (rowDiff === 0 && colDiff === 1) ||
            (rowDiff === 1 && colDiff === 1);
    }

    isPromotionZone(row: number, col: number): boolean {
        // Zones de promotion : 3 premiÃ¨res et 3 derniÃ¨res rangÃ©es
        return row <= 2 || row >= 6;
    }

    // Gestion du glisser-dÃ©poser
    onDragStart(event: DragEvent, row: number, col: number): void {
        const piece = this.getPieceAt(row, col);
        if (piece && piece.color === 'white') {
            this.draggedPiece = { row, col };
            this.selectedPiece = null;

            // CrÃ©er une image de drag personnalisÃ©e
            if (event.dataTransfer) {
                event.dataTransfer.effectAllowed = 'move';
                event.dataTransfer.setData('text/plain', `${row},${col}`);
            }
        } else {
            event.preventDefault();
        }
    }

    onDragOver(event: DragEvent, row: number, col: number): void {
        if (this.isValidMove(row, col)) {
            event.preventDefault();
            event.dataTransfer!.dropEffect = 'move';
            this.dragOverCell = { row, col };
        }
    }

    onDragLeave(event: DragEvent): void {
        this.dragOverCell = null;
    }

    onDrop(event: DragEvent, row: number, col: number): void {
        event.preventDefault();

        if (this.draggedPiece && this.isValidMove(row, col)) {
            const piece = this.getPieceAt(this.draggedPiece.row, this.draggedPiece.col);
            if (piece) {
                piece.position = { row, col };
            }
        }

        this.draggedPiece = null;
        this.dragOverCell = null;
    }

    onDragEnd(event: DragEvent): void {
        this.draggedPiece = null;
        this.dragOverCell = null;
    }

    // Gestion des clics (mÃ©thode alternative)
    onPieceClick(row: number, col: number, event: Event): void {
        event.stopPropagation();
        const piece = this.getPieceAt(row, col);

        if (piece && piece.color === 'white') {
            this.selectedPiece = { row, col };
        }
    }

    onCellClick(row: number, col: number): void {
        if (this.selectedPiece && this.isValidMove(row, col)) {
            // DÃ©placer la piÃ¨ce
            const piece = this.getPieceAt(this.selectedPiece.row, this.selectedPiece.col);
            if (piece) {
                piece.position = { row, col };
                this.selectedPiece = null;
            }
        } else if (!this.getPieceAt(row, col)) {
            // DÃ©sÃ©lectionner si on clique sur une case vide
            this.selectedPiece = null;
        }
    }

    enterClan() {
        console.log('Bienvenue dans le clan Nara !');
    }
} 